---
import { getCollection } from "astro:content";
import ArticlesOverview from "./ArticleOverview.astro";
import OptimizedImage from "./OptimizedImage.astro";
const allArticles = await getCollection("articles");

const recent = allArticles
  .sort(function (a, b) {
    return b.data.pubDate.getTime() - a.data.pubDate.getTime();
  })
  .slice(0, 8); // Show 8 articles on homepage

const hasMoreArticles = allArticles.length > 8;
---

<div class="latest-header">
  <h2 class="latest-header-text">Latest Articles</h2>
  <a href="/articles" class="route-links">
    <span>All articles</span>
    <svg
      width="18"
      height="18"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </a>
</div>

<div class="articles-list">
  {
    recent.map((article) => (
      <ArticlesOverview
        url={"/articles/" + article.slug}
        title={article.data.title}
        pubDate={article.data.pubDate}
        description={article.data.description}
      />
    ))
  }
</div>

{
  hasMoreArticles && (
    <div class="view-more">
      <a href="/articles" class="view-more-link">
        View all {allArticles.length} articles â†’
      </a>
    </div>
  )
}

<style>
  .latest-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
  }

  .latest-header-text {
    font-size: var(--font-size-xl);
    margin: 0;
  }

  .route-links {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    text-decoration: none;
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-secondary);
    transition: color var(--transition-speed) var(--transition-ease);
  }

  .route-links:hover {
    color: var(--accent);
  }

  .route-links svg {
    transition: transform var(--transition-speed) var(--transition-ease);
  }

  .route-links:hover svg {
    transform: translateX(4px);
  }

  .articles-list {
    display: flex;
    flex-direction: column;
  }

  .view-more {
    display: flex;
    justify-content: center;
    margin-top: var(--spacing-sm);
  }

  .view-more-link {
    font-size: var(--font-size-base);
    font-weight: 600;
    text-decoration: none;
    color: var(--accent);
    padding: var(--spacing-sm) var(--spacing-lg);
    border-radius: var(--radius-md);
    background: var(--bg-secondary);
    transition: all var(--transition-speed) var(--transition-ease);
  }

  .view-more-link:hover {
    background: var(--accent);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  @media (max-width: 600px) {
    .latest-header-text {
      font-size: var(--font-size-lg);
    }
  }
</style>
